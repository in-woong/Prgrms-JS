<html lang="en">
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list-1"></div>
    <div id="todo-list-2"></div>
    <div id="todo-list-3"></div>
    <script>
      const ERROR_MESSAGE = {
        NEW_KEYWORD: "You should use 'new' keyword when calling this function",
        DATA_TYPE: `Invalid data type in 'data' parameter. This should be array: `,
        DATA_CONTENT: `all items in 'data' parameter should have key 'text'`,
      };

      const data1 = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: true,
        },
      ];
      const data2 = [
        {
          text: '저녁 메뉴 정하기',
          isCompleted: false,
        },
        {
          text: '빨래하기',
          isCompleted: false,
        },
        {
          text: '1시간 운동하기',
          isCompleted: true,
        },
      ];
      const data3 = [
        {
          text: '코드리뷰하기',
          isCompleted: false,
        },
        {
          text: '포트폴리오 만들기',
          isCompleted: true,
        },
      ];

      const $ = (selector) => document.querySelector(selector);

      function TodoList($target, data) {
        if (!new.target) {
          throw new Error(ERROR_MESSAGE.NEW_KEYWORD);
        }

        const validateData = (data) => {
          if (!Array.isArray(data)) {
            throw new Error(`${ERROR_MESSAGE.DATA_TYPE} ${data} `);
          }
          const hasText = data.every(({ text }) => text);

          if (!hasText || !data.length) {
            throw new Error(`${ERROR_MESSAGE.DATA_CONTENT}`);
          }
        };

        validateData(data);

        const $todoList = document.createElement('ul');

        this.data = data;

        this.setState = (nextData) => {
          validateData(nextData);

          this.data = nextData;
          this.render();
        };

        this.render = () => {
          $todoList.innerHTML = `
          ${this.data
            .map(({ text, isCompleted }) => {
              return `
              <li>
                <p>
                  ${isCompleted ? `<s>${text}</s>` : text}
                </p>
              </li>
              `;
            })
            .join('')}
          `;
        };
        $target.appendChild($todoList);

        this.render();
      }

      const firstTodo = new TodoList($('#todo-list-1'), data1);
      const secondTodo = new TodoList($('#todo-list-2'), data2);
      const thirdTodo = new TodoList($('#todo-list-3'), data3);

      secondTodo.setState(data1);
    </script>
  </body>
</html>
