<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list"></div>
    <div id="todo-list-2"></div>
    <div id="todo-list-3"></div>
    <script>
      const data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ];

      const data2 = [
        {
          text: 'JAVA 공부하기',
          isCompleted: true,
        },
        {
          text: 'JAVA 복습하기',
          isCompleted: true,
        },
      ];

      const data3 = [
        {
          text: 'C 공부하기',
          isCompleted: false,
        },
        {
          text: 'C 복습하기',
          isCompleted: false,
        },
      ];

      const data4 = [
        {
          text: 'Rust 공부하기',
          isCompleted: false,
        },
        {
          text: 'Rust 복습하기',
          isCompleted: false,
        },
      ];

      const $todoList = document.querySelector('#todo-list');
      const $todoList2 = document.querySelector('#todo-list-2');
      const $todoList3 = document.querySelector('#todo-list-3');

      function TodoList(data, container) {
        const todoTemplate = (todo) =>
          todo.isCompleted
            ? `<li><s>${todo.text}</s></li>`
            : `<li>${todo.text}</li>`;

        const drawTodos = () => {
          const todos = this.data.map((todo) => todoTemplate(todo)).join('');
          this.container.innerHTML = `<ul>${todos}</ul>`;
        };

        const validateData = (data) => {
          if (
            !data ||
            !Array.isArray(data) ||
            !data.length ||
            !data.every(
              (value) =>
                typeof value === 'object' &&
                value.hasOwnProperty('text') &&
                value.hasOwnProperty('isCompleted')
            )
          ) {
            throw new Error('올바른 데이터를 넣어주세요');
          }
        };

        const validateContainer = (container) => {
          if (container.tagName !== 'DIV') {
            throw new Error('<div> 태그를 컨테이너로 사용해주세요');
          }
        };

        const isCalledByNew = () => {
          if (!new.target) {
            throw new Error('new 키워드를 사용해주세요');
          }
        };

        const init = () => {
          isCalledByNew();
          validateData(data);
          validateContainer(container);
          this.render();
        };

        this.data = data;
        this.container = container;
        this.render = function () {
          drawTodos();
        };
        this.setState = function (nextData) {
          validateData(nextData);
          this.data = nextData;
          drawTodos();
        };

        init();
      }

      const todoList = new TodoList(data, $todoList);

      const todoList2 = new TodoList(data2, $todoList2);

      const todoList3 = new TodoList(data3, $todoList3);
      todoList3.setState(data4);
    </script>
  </body>
</html>
