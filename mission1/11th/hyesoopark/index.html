<html>

<head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
</head>

<body>
    <div id="todo-list"></div>
    <script>
        const data = [
            {
                text: 'JS 공부하기',
                isCompleted: true,
            },
            {
                text: 'JS 복습하기',
                isCompleted: false,
            },
        ]

        const emptyData = undefined;

        const dataAsObject = {};

        const dataWithWrongFieldType = [
            {
                text: 'JS 공부하기',
                isCompleted: 'true',
            },
            {
                text: 'JS 복습하기',
                isCompleted: "false",
            },
        ]

        const validateData = (todos) => {
            if (todos === null || todos === undefined) {
                throw new Error('데이터가 존재하지 않습니다.')
            };

            if (!Array.isArray(todos)) {
                throw new Error('데이터가 Array 형태가 아닙니다.')
            };

            for (const todo of todos) {
                if (typeof todo.text !== 'string' && typeof todo.isCompleted !== 'boolean') {
                    throw new Error("text와 isCompleted 필드 타입이 유효하지 않습니다.")
                };

                if (typeof todo.text !== 'string' && typeof todo.isCompleted === 'boolean') {
                    throw new Error("text 필드 타입이 String 타입이 아닙니다.")
                };

                if (typeof todo.text === 'string' && typeof todo.isCompleted !== 'boolean') {
                    throw new Error("isCompleted 필드 타입이 boolean이 아닙니다.")
                };
            };
        }

        const TodoList = function (todos) {
            if (!(this instanceof TodoList)) {
                return new Error('new 키워드로 생성해주세요.')
            }

            this.state = todos;

            validateData(this.state);

            try {
                this.render = function () {
                    document.querySelector('#todo-list').innerHTML =
                        this.state.filter(todo => todo.text)
                            .map(todo =>
                                `<div>${todo.text}</div>`).join('')
                };

                this.setState = nextState => {
                    this.state = nextState;
                    this.render()
                }

            } catch (error) {
                console.log(error)
            }
        }

        const todoList = new TodoList(data);
        todoList.render();

        todoList.setState([
            {
                text: 'buy berries',
                isCompleted: false,
            },
            {
                wrong: 'prepare clothes',
                isCompleted: true,
            }
        ])

        const todoListWithMissingNew = TodoList(data);
        console.log('todoListWithMissingNew', todoListWithMissingNew);

        // throw errors when passing a wrong parameter to a constructor function
        const emptyTodoList = new TodoList(emptyData);
        const todoListAsObject = new TodoList(dataAsObject);
        const todoListWithWrongParameter = new TodoList(dataWithWrongFieldType);

    </script>
</body>

</html>