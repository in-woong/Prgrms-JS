<html>

<head>
  <title>Mission 1</title>
  <meta charset="utf-8" />
</head>

<body>
  <div id="todo-list1"></div>
  <div id="todo-list2"></div>
  <div id="todo-list3"></div>
  <script>
	// 이곳에서 코딩을 시작하세요!
    const dataBundle = [[{
          text: 'JS 공부하기',
          isCompleted : false,
        },{
          text: 'JS 복습하기',
          isCompleted : false,
        }],[{
          text: 'CSS 공부하기',
          isCompleted : true,
        },{
          text: 'CSS 복습하기',
          isCompleted : false,
        }],[{
          text: '로그인 코드 리팩토링 하기',
          isCompleted : true,
        },{
          text: '로그인 화면 디자인 변경하기',
          isCompleted: true,
        }]];

    const todoLists = [
      document.querySelector('#todo-list1'), document.querySelector('#todo-list2'), document.querySelector('#todo-list3')
    ];

    function TodoList(data, todoListElem){
      
      if(!(this instanceof TodoList)){
        // new를 통해 생성하지 않고 TodoList를 호출할 경우 this가 window 객체가 된다.
        throw new Error('new를 통해 생성해주세요');

      } else if(!data || data.length === 0) {
        // data가 null, undefined인 경우 + 빈 배열인 경우
        throw new Error("데이터가 존재하지 않습니다");

      } else if(!Array.isArray(data)){
        // data가 객체인경우
        throw new Error("배열을 입력해주세요");

      } else{
        data.forEach(x => {
          // data 내부의 객체가 text를 key로 가지고 있지 않은 경우 
          if(!x.text) throw new Error('text가 존재하지 않습니다.');

          // text를 key로 가지고 있으나 문자열이 아닌 경우
          if(typeof x.text !== 'string') throw new Error('text가 string 형태가 아닙니다.');
        });
      }
      
      this.data = data;
      this.todoListElem = todoListElem;

      this.render = todoListElem => {
        // appendChild는 매번 dom을 다시 계산해야하기 때문에 innerHTML이 더 나아보임
        let htmlStr = this.data.reduce((acc, item) =>  acc + (
            item.isCompleted ?`<div><s>${item.text}</s></div>\n` : `<div>${item.text}</div>\n`
          ), '');
        this.todoListElem.innerHTML = htmlStr;
      };

      this.setState = nextData => {
        this.data = nextData; 
        this.render(this.todoListElem);
      };
    };
    
    dataBundle.forEach((data,i)=> {
      const todoList = new TodoList(data, todoLists[i]);
      todoList.render();
      todoList.setState(dataBundle[2 - i]);
    });

    
  </script>
</body>
</html>