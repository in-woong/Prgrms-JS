<!DOCTYPE html>
<html lang="ko">

<head>
	<title>Mission 1</title>
	<meta charset="utf-8"/>
</head>

<body>
<div id="todo-list"></div>
<div id="developer-todo-list"></div>
<div id="happy-life-todo-list"></div>

<script>
	const data = [
		{
			text: 'JS 공부하기',
			isCompleted: false,
		},
		{
			text: 'JS 복습하기',
			isCompleted: true,
		},
	];

	const nextData = [
		{
			text: 'HTML/CSS 공부하기',
			isCompleted: false,
		},
	];

	const developerTodoItems = [
		{
			text: 'JS 스터디 열심히 참여하며 배운내용 잘 정리',
			isCompleted: true,
		},
		{
			text: '사이드 프로젝트 개선',
			isCompleted: false,
		},
	];

	const nextDeveloperTodoItems = [
		{
			text: 'HTTP 공부',
			isCompleted: true,
		},
	];

	const happyLifeTodoItems = [
		{
			text: '책 읽고 간단히라도 글 쓰기',
			isCompleted: true,
		},
		{
			text: '규칙적인 아침 기상',
			isCompleted: false,
		},
		{
			text: '조급해하지 않기',
			isCompleted: true,
		},
	];

	const nextHappyLifeTodoItems = [
		{
			text: '규칙적인 운동',
			isCompleted: false,
		},
	];

	function TodoList({todoItems, targetElementId}) {
		if (!(this instanceof TodoList)) { //new 키워드로 호출하지 않은 경우
			errorHandler();
		}
		if (!isValidTodoItems({todoItems})) {
			errorHandler();
		}

		this.todoItems = todoItems;
		this.render = function () {
			const $todoList = document.getElementById(targetElementId);
			$todoList.innerHTML = this.todoItems.map(todoItem => convertTodoItemToInnerHtml({todoItem})).join('');
		};
		this.setState = function ({nextTodoItems}) {
			this.todoItems = nextTodoItems;
			this.render();
		};
	}

	function convertTodoItemToInnerHtml({todoItem}) {
		const {text, isCompleted} = todoItem;
		return `
			<div>
				${isCompleted ? '<s>' : ''}
					${text}
				${isCompleted ? '</s>' : ''}
			</div>
		`;
	}

	function isValidTodoItems({todoItems}) {
		if (!todoItems) { //null or undefined
			return false;
		}

		if (!Array.isArray(todoItems)) { //not array
			return false;
		}

		return todoItems.every(todoItem => isValidTodoItem({todoItem}));
	}

	function isValidTodoItem({todoItem}) {
		const {text, isCompleted} = todoItem;

		if (typeof text !== 'string' || text.trim() === '') {
			return false;
		}

		if (typeof isCompleted !== 'boolean') {
			return false;
		}

		return true;
	}

	function errorHandler() {
		throw new Error('error message');
	}

	const todoList = new TodoList({todoItems: data, targetElementId: 'todo-list'});
	todoList.render();
	setTimeout(() => todoList.setState({nextTodoItems: nextData}), 500);

	const developerTodoList = new TodoList({todoItems: developerTodoItems, targetElementId: 'developer-todo-list'});
	developerTodoList.render();
	setTimeout(() => developerTodoList.setState({nextTodoItems: nextDeveloperTodoItems}), 500);

	const happyLifeTodoList = new TodoList({todoItems: happyLifeTodoItems, targetElementId: 'happy-life-todo-list'});
	happyLifeTodoList.render();
	setTimeout(() => happyLifeTodoList.setState({nextTodoItems: nextHappyLifeTodoItems}), 500);

</script>
</body>
</html>
