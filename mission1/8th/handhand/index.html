<html>

<head>
  <title>Mission 1</title>
  <meta charset="utf-8" />
</head>

<body>
  <div id="todo-list1"></div>
  <div id="todo-list2"></div>
  <div id="todo-list3"></div>

  <script type="module">
    import { data1, data2, data3, data4 } from './data.js';
    
    
    function checkValidation(todos) {
      if (!todos || !Array.isArray(todos)) { 
        throw new Error('인자가 배열 형태가 아닙니다!'); 
      }

      todos.forEach(todo => {
        if (!todo.hasOwnProperty('text') || !todo.text) {
          throw new Error('데이터 형식이 올바르지 않습니다!');
        }
      })
    }
  
    function TodoList(data, id) {
      if (!new.target) { throw new Error('new 키워드를 사용해주세요!'); }
      checkValidation(data);
      
      this.todos = data;
      this.id = id;
    }

    TodoList.prototype.render = function() {
      const todoDiv = document.querySelector(this.id);
      let orderedList = null;

      // ol 노드가 존재하면 사용하고 아니면 새로 만들어서 할당
      if (!todoDiv.firstChild) {
        orderedList = document.createElement('ol');
        todoDiv.append(orderedList);
      } else {
        orderedList = todoDiv.firstChild;
      }
      
      const renderData = this.todos.map(todo => 
      `<li>${ todo.isCompleted ? `<s>${todo.text}</s>` : todo.text }</li>`).join('');
      orderedList.innerHTML = renderData;
    }

    TodoList.prototype.setState = function(nextData) {
      this.todos = nextData;
      this.render();
    }
    
    // 인스턴스를 생성하고 랜더링을 수행합니다.
    const todoList1 = new TodoList(data1, '#todo-list1');
    const todoList2 = new TodoList(data2, '#todo-list2');
    const todoList3 = new TodoList(data3, '#todo-list3');
    todoList1.render();
    todoList2.render();
    todoList3.render();

    todoList1.setState(data4);
  </script>
</body>

</html>
