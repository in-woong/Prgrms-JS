<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
    <style>
      body > div {
        border: 1px solid black;
        margin-bottom: 10px;
      }
    </style>
  </head>

  <body>
    <div id="todo-list"></div>
    <div id="month-todo-list"></div>
    <div id="year-todo-list"></div>
    <script>
      const data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ];

      // 이곳에서 코딩을 시작하세요!
      const monthData = [
        {
          text: '치과 가기',
          isCompleted: false,
        },
        {
          text: '안과 가기',
          isCompleted: true,
        },
      ];
      const yearData = [
        {
          text: '취업 하기',
          isCompleted: true,
        },
        {
          text: '코테 합격하기',
          isCompleted: true,
        },
      ];

      class TodoList {
        #data;
        #todoList = document.querySelector('#todo-list');
        #id;
        #keyTypeObject = {
          text: `string`,
          isCompleted: `boolean`,
        };
        #selectedDOM;

        /**
         * constructor
         *
         * 생성자 함수를 통해 list를 만들 DOM의 id와 list data를 받아옵니다
         * id, data는 유효성 검사를 거칩니다
         * @param {string} id
         * @param {Array} data
         */

        constructor(id, data) {
          try {
            if (!this.#checkData(data, this.#keyTypeObject)) {
              throw new Error(`[data error]: data is not accurate`);
            }
            if (typeof id !== 'string' || id === '') {
              throw new Error('[id error]: id is not accurate');
            }
            this.#data = data;
            this.#id = id;
            this.#selectedDOM = document.querySelector(`#${this.#id}`);
          } catch (err) {
            console.error(err);
          }
        }

        /**
         * checkData
         *
         * data의 유효성을 검사합니다.
         * 1. data의 값이 undefind 이거나 null
         * 2. data가 배열인지
         * 3. data안의 객체의 property들이 정확한지 (checkProperty 통함)
         *
         * keyTypeObject는 property에 대한 타입이 명시되어 있습니다.
         *
         * @param {Array} data
         * @param {Object} keyTypeObject
         */

        #checkData(data, keyTypeObject) {
          if (
            !!data &&
            data.length > 0 &&
            Array.isArray(data) &&
            data.every((object) => this.#checkProperty(object, keyTypeObject))
          ) {
            return true;
          }
          return false;
        }

        /**
         * checkProperty
         *
         * data안의 객체에 대한 유효성을 검사합니다
         * 1. 객체에 keyTypeObject에 명시한 프로퍼티가 있는지
         * 2. keyTypeObject에 명시한 프로퍼티에 대한 타입이 맞는지
         * 3. 프로퍼티가 빈값은 아닌지
         *
         * @param {Object} object
         * @param {Object} keyTypeObject
         */

        #checkProperty(object, keyTypeObject) {
          const keys = Object.keys(keyTypeObject);
          return keys.every((property) => {
            if (
              object.hasOwnProperty(property) &&
              typeof object[property] === keyTypeObject[property] &&
              object[property] !== ''
            ) {
              return true;
            }
            return false;
          });
        }

        setState(nextData) {
          try {
            if (!this.#checkData(nextData, this.#keyTypeObject)) {
              throw new Error(`[data error]: data is not accurate`);
            }
            this.#data = nextData;
            this.render(this.#data);
          } catch (err) {
            console.error(err);
          }
        }

        render() {
          try {
            if (!this.#checkData(this.#data, this.#keyTypeObject)) {
              throw new Error(`[data error]: data is not accurate`);
            }
            const markup = this.#data
              .map((data) => this.#generateMarkup(data))
              .join(' ');
            this.#selectedDOM.innerHTML = `<ul>${markup}</ul>`;
          } catch (err) {
            console.error(err);
          }
        }

        /**
         * generateMarkup
         *
         * markup string을 만들어주는 함수입니다
         * data 객체의 isCompleted가 true 라면 삭선을 만듭니다
         *
         * @param {Object} object
         * @param {Object} keyTypeObject
         */

        #generateMarkup({ text, isCompleted }) {
          return isCompleted
            ? `
            <li><s>${text}</s></li>
            `
            : ` <li>${text}</li>`;
        }
      }

      const todoList = new TodoList('todo-list', data);
      const monthTodoList = new TodoList('month-todo-list', monthData);
      const yearTodoList = new TodoList('year-todo-list', yearData);
      todoList.render();
      monthTodoList.render();
      yearTodoList.render();
      todoList.setState(yearData);
    </script>
  </body>
</html>
