<html>

<head>
  <title>Mission 1</title>
  <meta charset="utf-8" />
</head>

<body>
  <!-- 
    TodoList 라는 이름을 가진 함수를 작성합니다.
    해당 함수는 new 키워드를 이용해 생성되며, 파라메터로 위의 data를 넘겨받습니다. ex) var todoList = new TodoList(data);
    TodoList 함수는 파라메터로 넘겨받은 data를 this 키워드를 이용해 함수 내 변수로 저장해둡니다. this.data = data 이런 식으로요.
    this.render = function{ ... } 형태로 TodoList 함수 내에 render function을 작성합니다.
    이 함수는 data를 이용해 data 배열을 순회하며 각 배열첨자의 text를 html로 만든 뒤, todo-list라는 id를 가진 div에 data의 text가 렌더링되도록 작성합니다. 아래 Tip을 참고하세요.
    위에서 작성한 TodoList 함수를 var todoList = new TodoList(data); 형태로 생성한 후, todoList.render() 함수를 호출하여 실행되게 작성합니다. 
  -->
  <div id="todo-list"></div>
  <br>
  <div>4월 계획</div>
  <div id="Apr_todo-list"></div>
  <br>
  <div>5월 계획</div>
  <div id="May_todo-list"></div>

  <br>
  <button onclick="nextDataDisplay()">다음보기</button>

  <script>
    var data = [
      {
        text: 'JS 공부하기',
        isCompleted: true
      },
      {
        text: 'JS 복습하기',
        isCompleted: true
      }
    ]

    var aprillData = [
      {
        text: '퇴사하기',
        isCompleted: false
      },
      {
        text: '제주도 한달살이',
        isCompleted: false
      }
    ]


    var mayData = [
      {
        text: '제주도에서 앱만들기',
        isCompleted: false
      },
      {
        text: '현실복귀',
        isCompleted: false
      }
    ]

    var nextData = [
      {
        text: '프로그래머스',
        isCompleted: false
      },
      {
        text: '화이팅',
        isCompleted: false
      }
    ]

    // 이곳에서 코딩을 시작하세요!
    function nextDataDisplay() {
      todoList.setState(nextData);
    }

    function TodoList(data, selector) {
      this.data = data;
      this.seletor = selector;

      // #50 validator
      if (!new.target) {
        //new 키워드로 선언되지 않은 경우
        throw new Error("new 키워드로 함수를 선언해주세요.");
      }

      this.dataValidator = function (data) {
        if (typeof data == 'undefined' || data == null) {
          //할당하기 전 호출한 경우
          throw new Error("[data]이 할당되어 있지 않습니다.");
        } else if (!Array.isArray(data)) {
          //배열이 아닌 경우
          throw new Error("[data]가 배열이 아닙니다.");
        } else if (data.some(data => !("text", "isCompleted" in data))) {
          // 원하는 구조로 호출되지 않은 경우
          throw new Error("[data] 배열에 key가 잘못되었습니다.");
        }
      }
      // #50 end

      this.dataValidator(this.data)

      this.render = function () {
        //#66 계획 완료시 삭선처리
        const resultData = this.data.map(data => {
          return data.isCompleted ? {...data, text: `<s>${data.text}</s>`} : data;
        });

        const innerHTML = resultData.map(data => `<div>${data.text}</div>`).join('');

        document.querySelector(selector).innerHTML = innerHTML;
      }

      // #67 보너스 구현사항
      this.setState = function (nextData) {
        this.dataValidator(nextData)
        this.data = nextData;
        this.render();
      }
    }

    const todoList = new TodoList(data, '#todo-list');
    todoList.render();

    const aprTodoList = new TodoList(aprillData, '#Apr_todo-list');
    aprTodoList.render();

    const mayTodoList = new TodoList(mayData, '#May_todo-list');
    mayTodoList.render();

  </script>
</body>

</html>