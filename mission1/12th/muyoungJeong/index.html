<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list"></div><br>
    <div id="twodo-list"></div><br>
    <div id="threedo-list"></div><br>

    <script>
      const data = [
        {
          text: 'JS ê³µë¶€í•˜ê¸°',
          isCompleted: true,
        },
        {
          text: 'JS ë³µìŠµí•˜ê¸°',
          isCompleted: false,
        },
      ]

      const data2 = [
        {
          text: 'í•„ìˆ˜ êµ¬í˜„ì‚¬í•­ êµ¬í˜„í•˜ê¸°',
          isCompleted: true,
        },
        {
          text: 'ë³´ë„ˆìŠ¤ êµ¬í˜„ì‚¬í•­ ì „ë¶€ êµ¬í˜„í•˜ê¸°',
          isCompleted: false,
        }
      ]

      const data3 = [
        {
          text: 'ì–‘ì¹˜í•˜ê¸°',
          isCompleted: true,
        },
        {
          text: 'ìƒ¤ì›Œí•˜ê¸°',
          isCompleted: false,
        },
        {
          text: 'ìž ìžê¸°',
          isCompleted: false,
        }
      ]

      // ì´ê³³ì—ì„œ ì½”ë”©ì„ ì‹œìž‘í•˜ì„¸ìš”!
      function checkIsTodoListDataFine(data) {
        if (!Array.isArray(data)) {
          throw new Error("dataëŠ” Array íƒ€ìž…ìž…ë‹ˆë‹¤.")
        }

        const hasWeirdAttribute = data.some(item => 
          typeof item.text !== 'string' || typeof item.isCompleted !== 'boolean'
        )

        if (hasWeirdAttribute) {
          throw new Error("ì˜¬ë°”ë¥¸ ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ì„¸ìš”.")
        }
      }

      renderTodoText = (text, isCompleted) => 
        isCompleted ? `<s>${text}</s>` : `<span>${text}</span>`
      

      function TodoList(data, targetElemId) {
        if (!(this instanceof TodoList)) {
          throw new Error("new í‚¤ì›Œë“œì¨ì„œ ì“°ì„¸ìš”.")
        }

        checkIsTodoListDataFine(data)

        this.data = data
        this.targetElemId = targetElemId

        this.render = () => {
          const todoListDom = this.data.reduce((result, todo) => (
            result + (`
            <div>
              ${renderTodoText(todo.text, todo.isCompleted)}
              <span>${todo.isCompleted ? 'âœ…' : 'ðŸ“ƒ'}</span>
            </div>
          `)), '')

          const $root = document.getElementById(this.targetElemId)
          $root.innerHTML = todoListDom
        }
        
        this.setState = (data) => {
          checkIsTodoListDataFine(data)

          this.data = data
          this.render()
        }
      }

      const todoList = new TodoList(data, "todo-list")
      todoList.render()

      const twodoList = new TodoList(data2, "twodo-list")
      twodoList.render()
      setTimeout(() => {
        data2[1].isCompleted = true
        twodoList.setState(data2)
      }, 2000)

      const threedoList = new TodoList(data3, "threedo-list")
      threedoList.render()
    </script>
  </body>
</html>
