<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list"></div>
    <script>
      const data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ]

      const $ = (selector, scope = document) => scope.querySelector(selector);

      const isEmptyValue = (data) => {
        const isEmpty = ({text, isCompleted}) => (text === '' || isCompleted === '');

        return Object.values(data).some(isEmpty);
      }

      const isTextNotStringType = (data) => {
        const isNotString = ({text}) => (typeof(text) !== 'string') && !(text instanceof String);

        return (Object.values(data).some(isNotString));
      }

      const isCompletedNotBooleanType = (data) => {
        const isNotBoolean = ({isCompleted}) => (typeof(isCompleted) !== 'boolean') && !(isCompleted instanceof Boolean);

        return Object.values(data).some(isNotBoolean);
      }

      const isWrongValueFormat = (data) => {
        if (isEmptyValue(data)) {
          return true;
        }
        if (isTextNotStringType(data)) {
          return true;
        }
        if (isCompletedNotBooleanType(data)) {
          return true
        }
      }

      const isWrongKeyFormat = (data) => {
        const keyFormat = ['text', 'isCompleted'];
        const condition = (value) => JSON.stringify(Object.keys(value)) !== JSON.stringify(keyFormat);

        return Object.values(data).some(condition)
      }

      const isDataFormatError = (data) => {
        if (isWrongKeyFormat(data)) {
          return true;
        }
        if (isWrongValueFormat(data)) {
          return true;
        }
        return false;
      }

      const isValidData = (data) => {
        if (data === null || data === undefined) {
          return false;
        }
        if (!Array.isArray(data)) {
          return false;
        }
        if (isDataFormatError(data)) {
          return false;
        }
        return true;
      }

      const isInstanceFromNew = (instance, targetFunction) => instance instanceof targetFunction;

      const isValid = (targetFunction, instance, data) => {
        if (!isInstanceFromNew(instance, targetFunction)) {
          throw new Error('error message');
        }
        if (!isValidData(data)) {
          throw new Error('error message');
        }
      }

      const TodoList = function(data) {
        try {
          isValid(TodoList, this, data);
        } catch (e) {
          console.error(e);
        }

        this.state = data;

        this.render = function () {
          $('#todo-list').innerHTML = this.state.map(({text}) =>
            `<li>${text}</li>`
          ).join('');
        }
      }

      const todoList = new TodoList(data);

      todoList.render();
    </script>
  </body>
</html>
