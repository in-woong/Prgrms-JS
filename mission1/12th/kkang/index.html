<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list"></div>
    <div id="todo-list1"></div>
    <div id="todo-list2"></div>
    <div id="todo-list3"></div>
    <script>
      const data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ]

      const data1 = [
        {
          text: '코드 구조 개선하기',
          isCompleted: false,
        },
        {
          text: '저녁 식사',
          isCompleted: false,
        },
      ]

      const data2 = [
        {
          text: '스트레칭 하기',
          isCompleted: true,
        },
        {
          text: 'React 공부하기',
          isCompleted: false,
        },
      ]

      const data3 = [
        {
          text: '물먹기',
          isCompleted: true,
        },
        {
          text: '산책하기',
          isCompleted: false,
        },
      ]

      const $ = (selector, scope = document) => scope.querySelector(selector);

      const isEmptyValue = (data) => {
        const isEmpty = ({text, isCompleted}) => (text === '' || isCompleted === '');

        return Object.values(data).some(isEmpty);
      }

      const isTextNotStringType = (data) => {
        const isNotString = ({text}) => (typeof(text) !== 'string') && !(text instanceof String);

        return Object.values(data).some(isNotString);
      }

      const isCompletedNotBooleanType = (data) => {
        const isNotBoolean = ({isCompleted}) => (typeof(isCompleted) !== 'boolean') && !(isCompleted instanceof Boolean);

        return Object.values(data).some(isNotBoolean);
      }
			const isUnintendedProperty = (data) => {
				const filteredDataArray = data.map((element) =>
				  Object.getOwnPropertyNames(element).
					  filter((prop) => prop !== 'text' && prop !== 'isCompleted')
				);

				return filteredDataArray.some((dataArray) => dataArray.length !== 0)
			}
			
			const isFalsyPrimitiveValue = (data) => {
				return data.some(item => item === null || item === undefined);
			}

			const checkDataProperties = (data) => {
				if (isFalsyPrimitiveValue(data)) {
					throw new Error(`주어진 data에 [null] 또는 [undefined] 타입의 값이 있습니다.`);
				}
				if (isUnintendedProperty(data)) {
					throw new Error('주어진 data에 data, isCompleted 이외의 속성이 있습니다.');
				}
				if (!data.every((item) => item.hasOwnProperty('text'))) {
					throw new Error('주어진 data에 text 속성이 없습니다.');
				}
				if (!data.every((item) => item.hasOwnProperty('isCompleted'))) {
					throw new Error('주어진 data에 isCompleted 속성이 없습니다.');
				}
				if (isEmptyValue(data)) {
					throw new Error('주어진 data에 value가 빈 원소가 있습니다.')
				}
				if (isTextNotStringType(data)) {
					throw new Error('주어진 data에 text 속성의 value가 string이 아닌 원소가 있습니다.')
				}
				if (isCompletedNotBooleanType(data)) {
					throw new Error('주어진 data에 completed 속성의 value가 boolean이 아닌 원소가 있습니다.')
				}
			}

			const isEmptyArray = (data) => {
				return data.length === 0;
			}

      const checkErrorInputData = (data) => {
        if (data === null || data === undefined) {
          throw new Error('주어진 data가 null 또는 undefined입니다.')
        }
        if (!Array.isArray(data)) {
          throw new Error('주어진 data가 Array가 아닙니다.')
        }
				if (isEmptyArray(data)) {
					throw new Error('주어진 data가 빈 array입니다.')
				}
				checkDataProperties(data);
			}

			const TodoList = function($target, data) {
				if (this === window) {
					throw new Error('new 키워드를 이용해 TodoList를 생성하세요');
				}

				this.render = function () {
					const todoListHTMLString = this.state.map(({ text, isCompleted }) =>
					  isCompleted ? `<li><s>${text}</s></li>` : `<li>${text}</li>`
				  ).join('');

					$target.innerHTML = `<ul>${todoListHTMLString}</ul>`
				}

				this.setState = (nextData) => {
					try {
						checkErrorInputData(nextData);
						this.state = [...nextData];
						this.render();
					} catch (e) {
						console.error(e);
					}
				}
				
				try {
					checkErrorInputData(data)
					this.state = data;
					this.render();
				} catch (e) {
					console.error(e);
				}
			}

			const todoList = new TodoList($('#todo-list'), data);
			const todoList1 = new TodoList($('#todo-list1'), data1);
			const todoList2 = new TodoList($('#todo-list2'), data2);
			const todoList3 = new TodoList($('#todo-list3'), data3);

			setTimeout(() => {
				todoList3.setState([{text:'setState', isCompleted:true}])
			}, 3000)
		</script>
  </body>
</html>
