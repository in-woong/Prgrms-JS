<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
    <style>
      .todoContainer {
        padding-bottom: 20px;
      }
    </style>
  </head>

  <body>
    <div id="todo-list-study" class="todoContainer"></div>
    <div id="todo-list-housework" class="todoContainer"></div>
    <div id="todo-list-contact" class="todoContainer"></div>
    <script>
      const data_study = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
        {
          text: '미션1 수행하기',
          isCompleted: false,
        },
      ]

      const data_housework = [
        {
          text: '점심먹기',
          isCompleted: true,
        },
        {
          text: '빨래하기',
          isCompleted: false,
        },
        {
          text: '캡슐커피 사오기',
          isCompleted: false,
        },
      ];

      const data_contact = [
        {
          text: '엄마한테 전화하기',
          isCompleted: true,
        },
        {
          text: '아빠한테 전화하기',
          isCompleted: false,
        },
        {
          text: '할머니한테 전화하기',
          isCompleted: false,
        },
      ];

      // 이곳에서 코딩을 시작하세요!
      function isVaildTodo(todo) {
        if (!todo.hasOwnProperty('text')) return { error: true, message: 'text가 없습니다.' }
        if (todo.text === '') return { error: true, message: 'text는 필수입력입니다.' }
        if (!todo.hasOwnProperty('isCompleted')) return { error: true, message: 'isCompleted가 없습니다.'}
        if (typeof(todo.isCompleted) !== 'boolean') return { error: true, message: 'isCompleted는 true, false만 입력가능합니다.'}
        return { error: false, massage: '' }
      }

      function TodoList({ targetId, data = [] }) {
        
        this.$target = document.getElementById(targetId);
        this.data = data;

        this.setState = nextState => {
          this.validate(nextState);
          this.data = nextState;

          this.render();
        }
          
        this.render = () => {
          const template = this.data.map(todo => `
            <div${todo.isCompleted ? (` style="text-decoration: line-through"`) : ''}>${todo.text}</div>
          `).join('')
          
          this.$target.innerHTML = template;
        }

        this.validate = (data) => {
          if (data === null || data === undefined) throw new Error(`TargetId-[${targetId}] Error: data가 올바르지 않습니다.`)
          if (!Array.isArray(data)) throw new Error(`TargetId-[${targetId}] Error: data가 배열이 아닙니다.`)
          if (this === window) throw new Error(`TargetId-[${targetId}] Error: new 키워드를 사용하여 객체를 생성해 주세요.`)

          // 유효성 체크
          data.forEach((todo, index) => {
            const vaild = isVaildTodo(todo);
            if (vaild.error) throw new Error(`TargetId-[${targetId}] Error: index{${index}} ${vaild.message}`);
          });
        }

        this.validate(this.data);
        this.render();
      }

      const todoListStudy = new TodoList({targetId: 'todo-list-study', data: data_study});
      const todoListHousework = new TodoList({targetId: 'todo-list-housework', data: data_housework});
      const todoListContact = new TodoList({targetId: 'todo-list-contact', data: data_contact});

      todoListStudy.setState([{text: '새로운 TODO', isCompleted: false}]);

    </script>

  </body>
</html>
