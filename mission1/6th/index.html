<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list"></div>
    <div id="todo-list2"></div>
    <div id="todo-list3"></div>
    <script>
      // Data
      const data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ]
      const data2 = [
        {
          text: 'JS 공부하기 2',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기 2',
          isCompleted: true,
        },
      ]
      const data3 = [
        {
          text: 'JS 공부하기 3',
          isCompleted: false,
        },
        {
          text: 'JS 복습하기 3',
          isCompleted: false,
        },
      ]

      // 이곳에서 코딩을 시작하세요!

      // Validation

      function validateData(data) {
        function isValidDataFormat(data) {
          return data.length === 0
            ? false
            : data.every(
                (todo) =>
                  todo.hasOwnProperty('text') && typeof todo.text === 'string'
              )
        }

        if (data === null) {
          throw new Error('data is null')
        }
        if (data === undefined) {
          throw new Error('data is undefined')
        }

        if (!Array.isArray(data)) {
          throw new Error('only array type data is permitted')
        }

        if (!isValidDataFormat(data)) {
          throw new Error('data is not valid')
        }

        return data
      }

      //Todo List

      // Constructor function 사용
      function TodoList(data, parentId) {
        if (!new.target) throw 'TodoList() must be called with new'

        this.data = validateData(data)

        this.setState = (nextData) => {
          this.data = validateData(nextData)
          this.render()
        }

        this.render = () => {
          const todoList = document.querySelector(parentId)
          const todoListInnerHTML = `<ul>${this.data
            .map((todo, i) =>
              todo.isCompleted
                ? `<li><s>${todo.text}</s></li>`
                : `<li>${todo.text}</li>`
            )
            .join('')}</ul>`
          todoList.innerHTML = todoListInnerHTML
        }
      }

      // class 사용
      class TodoListClass {
        constructor(data, parentId) {
          this.data = validateData(data)
          this.parentId = parentId
        }
        setState(nextData) {
          this.data = validateData(nextData)
          this.render()
        }
        render() {
          const todoList = document.querySelector(this.parentId)
          const todoListInnerHTML = `<ul>${this.data
            .map((todo, i) =>
              todo.isCompleted
                ? `<li><s>${todo.text}</s></li>`
                : `<li>${todo.text}</li>`
            )
            .join('')}</ul>`
          todoList.innerHTML = todoListInnerHTML
        }
      }

      const todoList = new TodoList(data, '#todo-list')
      todoList.render()
      data.push({ text: '새로운 할 일 ', isCompleted: false })
      todoList.setState(data)

      const todoList2 = new TodoList(data2, '#todo-list2')
      todoList2.render()

      const todoList3 = new TodoListClass(data3, '#todo-list3')
      todoList3.render()
    </script>
  </body>
</html>
