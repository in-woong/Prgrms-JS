
<!DOCTYPE html>
<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <style>
    #todo-list, #todo-list-in-week, #todo-list-in-weekend {
      padding: 1rem;
    }
  </style>

  <body>
    <div id="todo-list"></div>
    <div id="todo-list-in-week"></div>
    <div id="todo-list-in-weekend"></div>

    <script>
      const data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        }
      ]
      const studyInWeek = [
        {
          text: '월~금 퇴근 후 토이프로젝트 개발',
          isCompleted: true,
        },
        {
          text: '수요일에 퇴근 후 스터디',
          isCompleted: true,
        },
        {
          text: '청소',
          isCompleted: false,
        }
      ]
      const studyInWeekend = [
        {
          text: '프론트엔드 전반적인 공부',
          isCompleted: false,
        },
        {
          text: '주중에 하던 토이프로젝트 코딩',
          isCompleted: true,
        },
        {
          text: '옷 세탁',
          isCompleted: false,
        }
      ]
      
      //setState 테스트 더미 데이터
      const testTodo = [
        {
          text: '꿀잠 자기',
          isCompleted: true,
        },
        {
          text: '맛있는거 먹기',
          isCompleted: true,
        },
        {
          text: '여행',
          isCompleted: false,
        }
      ]

      const errorMessage = {
        null_or_undefined : 'this data is null or undefined',
        not_object : 'this data is not an object',
        not_array : 'this data is not an array',
        not_exist_test_property : '\"text\" property does not exist in this data',
      }
      
      function isUndefinedOrNull(todo){
        return todo === null || todo === undefined
      }

      function isNotExistTextProperty(todo){
        return todo.some(element => !('text' in element))
      }

      function checkTodoListDataType(todoList){
        if(isUndefinedOrNull(todoList.todo)){
          throw new Error(errorMessage['null_or_undefined'])
        }

        if(!Array.isArray(todoList.todo)){
          throw new Error(errorMessage['not_array'])
        }

        if(isNotExistTextProperty(todoList.todo)){
          throw new Error(errorMessage['not_exist_test_property'])
        }
      }

      function checkTodoListInstance(todoList){
        if(!(todoList instanceof TodoList)){
          throw new Error(errorMessage['not_object'])
        }
      }

      function isCorrectTodoList(todoList){
        try {
          checkTodoListInstance(todoList) // 올바른 파라메터 체크
          checkTodoListDataType(todoList) // new 키워드 유무 체크
        }catch (e){
          console.error(e)
          return false
        }
        return true
      }

      function TodoList(selectorId, todo){
        this.selectorId = selectorId
        this.todo = todo

        this.getTodoListHtmlText = (isCompleted, todoText) => {
          return (isCompleted) ? `<div><s>${todoText}</s></div>` : `<div>${todoText}</div>`
        }

        this.createTodoInnerHtml = () => {
          let todoText = this.todo.map((element) => {
            return this.getTodoListHtmlText(element.isCompleted, element.text)
          }).join('')
          document.querySelector(this.selectorId).innerHTML = todoText
        }

        this.render = function(){
          isCorrectTodoList(this) ? this.createTodoInnerHtml() : ""
        }

        this.setState = function(nextData){
          this.todo = nextData
          this.render()
        }
      }

      function showTodoList(selectorId, todo){
        const todoList = new TodoList(selectorId, todo)
        todoList.render()
        return todoList
      }

      const standardTodoList = showTodoList('#todo-list', data)
      const weekTodoList = showTodoList('#todo-list-in-week', studyInWeek)
      const weekendTodoList = showTodoList('#todo-list-in-weekend', studyInWeekend)

      //setState 테스트
      standardTodoList.setState(testTodo)

    </script>
  </body>
</html>