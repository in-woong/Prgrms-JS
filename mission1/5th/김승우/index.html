<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Mission 1</title>
    <style>
      h1 {
        font-size: 1.25rem;
        text-transform: uppercase;
      }

      body > div {
        margin-bottom: 5rem;
        padding: 1rem;
        border-bottom: 1px solid black;
        border-top: 1px solid black;
      }
    </style>
  </head>
  <body>
    <h1>todo-list</h1>
    <div id="todo-list"></div>
    <h1>my-todo</h1>
    <div id="my-todo"></div>
    <h1>your-todo</h1>
    <div id="your-todo"></div>
    <!-- <div id="console"></div> -->
    <script>
      //Input Data
      var data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ]
      var data1 = [
        {
          text: '#50, #57 구현하기',
          isCompleted: true,
        },
        {
          text: '매일 Commit하기',
          isCompleted: false,
        },
        {
          text: '아메리카노 마시기',
          isCompleted: true,
        },
      ]

      //setState용 data
      var data3 = [
        {
          text: '다이어리 쓰기',
          isCompleted: true,
        },
        {
          text: '롤 하기',
          isCompleted: false,
        },
        {
          text: '노래방가기',
          isCompleted: false,
        },
      ]

      // 이곳에서 코딩을 시작하세요!

      //TodoList의 파라미터를 체크하는 함수

      function checkArray(data) {
        //배열인지 확인
        //data가 배열의 인스턴스인지 확인한다. 배열이 아닌 경우 에러 메시지와 함께 notError 변수를 false로 만든다.

        if (!(data instanceof Array)) {
          throw new Error('Data is not Array')
        }
        //배열의 length를 체크해서 빈 배열인지 확인한다.
        if (data.length === 0) {
          throw new Error('Data is Empty')
        }

        //배열의 각 요소들이 text 프로퍼티를 가지고 있지 않거나 text 프로퍼티가 문자열이 아닐경우
        //프로퍼티를 가지고 있는지 확인하기위해 객체의 hasOwnProperty() 메소드를 사용했습니다.
        for (const item of data) {
          // if (!item.hasOwnProperty('text') || typeof item.text !== 'string')
          if (!item.text || typeof item.text !== 'string') {
            throw new Error('Data의 text값이 없거나 text가 문자열이 아닙니다')
          }
        }

        return true
      }

      //checkArray() 함수의 리턴값에 따라
      //true라면 프로퍼티와 메소드를 생성하고, false라면 undefined를 리턴

      //렌더링 될 대상을 정의해주기 위해서 id 파라미터를 추가했습니다.
      //신수진님 코드와 로토님의 코드리뷰를 참고했습니다.
      function TodoList(inputData, inputId) {
        //todolist를 만들 대상
        const todoList = document.getElementById(inputId)

        //checkArray의 리턴값이 true이면
        if (checkArray(inputData)) {
          this.data = inputData

          //todolist를 렌더링하는 함수
          this.render = function() {
            todoList.innerHTML = this.data
              .map(el => {
                //isCompleted에 따라 return 을 바꿔준다.
                if (el.isCompleted) {
                  return `<div><s>${el.text}</s></div>`
                } else return `<div>${el.text}</div>`
              })
              .join('')
          }
          //#67 setState
          this.setState = nextData => {
            if (checkArray(nextData)) {
              todoList.innerHTML = nextData
                .map(el => {
                  if (el.isCompleted) {
                    return `<div><s>${el.text}</s></div>`
                  } else return `<div>${el.text}</div>`
                })
                .join('')
            }
          }
        }
        // checkArray()에서 에러가 발생하면 이쪽까지 실행이 오지 않기때문에 else구문은 불필요하다
        // if문을 try~catch로 감싸거나 todoList를 생성하는 쪽에 try~catch로 예외처리를한다.
        // else return undefined

        //생성자 함수가 new 키워드 없이 생성될 때 발생할 오류를 해결하기 위한 방법입니다.

        if (!(this instanceof TodoList)) {
          // return new TodoList(inputData, inputId)
          throw new Error('New 키워드 없이 함수를 실행하였습니다')
        }

        //객체가 생성되면 바로 render함수를 실행시킨다.
        this.render()
      }

      //예외처리

      //data가 빈 문자열일 경우
      try {
        const todo = new TodoList('', 'todo-list')
        todo.render()
      } catch (e) {
        console.log(e)
      }

      //data가 빈 배열일 경우
      try {
        const todo = new TodoList([], 'todo-list')
        todo.render()
      } catch (e) {
        console.log(e)
      }

      //데이터가 객체일 경우
      try {
        const todo = new TodoList({ text: 'JS 복습하기' }, 'todo-list')
        todo.render()
      } catch (e) {
        console.log(e)
      }

      //new 키워드 없이 함수 호출하는 것
      try {
        const newTodo = TodoList(data, 'todo-list')
      } catch (e) {
        console.log(e)
      }

      try {
        const todo = new TodoList(data, 'todo-list')
        todo.setState(data3)
      } catch (e) {
        console.log(e)
      }

      const myTodo = new TodoList(data1, 'my-todo')
      // myTodo.render()

      const yourTodo = new TodoList(
        [
          {
            text: '파스타 먹기',
            isCompleted: false,
          },
          {
            text: '햄버거먹기',
            isCompleted: true,
          },
        ],
        'your-todo'
      )
      yourTodo.setState([
        {
          text: '자소서 쓰기',
          isCompleted: true,
        },
        { text: 'JS 공부하기', isCompleted: true },
        {
          text: '컴퓨터 포맷하기',
          isCompleted: false,
        },
      ])
      // yourTodo.render()

      myTodo.setState(data3)
    </script>
  </body>
</html>
