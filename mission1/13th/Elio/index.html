<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list"></div>
    <div id="todo-list2"></div>
    <div id="todo-list3"></div>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script>
      const data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ]
      const data2 = [
        {
          text: '알고리즘 공부하기',
          isCompleted: true,
        },
        {
          text: '알고리즘 복습하기',
          isCompleted: false,
        },
      ]
      const data3 = [
        {
          text: '물 꾸준히 마시기',
          isCompleted: true,
        },
        {
          text: '과식하지 않기',
          isCompleted: false,
        },
      ]

      function TodoList(data, selector) {
        this.data = data

        this.validate = (data) => {
          if (_.isNil(data)) {
            throw new Error('데이터가 식별할 수 없습니다.')
          }

          if (!Array.isArray(data)) {
            throw new Error('array가 아닌 형태의 데이터입니다.')
          }

          if (data.length === 0) {
            throw new Error('빈 배열입니다')
          }

          data.forEach((todo) => {
            if (
              !todo.hasOwnProperty('text') ||
              !todo.hasOwnProperty('isCompleted')
            ) {
              throw new Error('데이터의 내용이 올바르지 않습니다.')
            }
            if (todo.text === '') {
              throw new Error('todo의 내용이 비어있습니다.')
            }
            // 데이터 타입 체크 로직
            if (typeof todo.text !== 'string') {
              throw new Error('text의 타입이 올바르지 않습니다.')
            }
            if (typeof todo.isCompleted !== 'boolean') {
              throw new Error('isCompleted의 타입이 올바르지 않습니다.')
            }
          })

          if (!new.target) {
            // new 키워드 안 붙이고 함수 실행 시 에러 발생하게 하기
            // new.target을 통해 생성자가 new 연산자를 사용하여 호출됐는지를 감지
            throw new Error('new 키워드와 함께 생성되지 않았습니다.')
          }
        }

        this.render = () => {
          // innerHTML 사용
          document.querySelector(
            selector
          ).innerHTML = `<ul>${this.data
            .map((todo) =>
              todo.isCompleted
                ? `<li>${todo.text}</li>`
                : `<li><s>${todo.text}</s></li>`
            )
            .join('')}<ul>`
        }

        this.setState = (nextData) => {
          this.validate(nextData)
          this.data = nextData
          this.render()
        }

        this.validate(this.data)
        this.render() // 별도로 render() 호출하지 않게끔
      }

      const todoList = new TodoList(data, '#todo-list')
      const todoList2 = new TodoList(data2, '#todo-list2')
      const todoList3 = new TodoList(data3, '#todo-list3')

      todoList.setState([
        {
          text: 'JS 뿌시기',
          isCompleted: true,
        },
        {
          text: '취업하기',
          isCompleted: false,
        },
      ])
    </script>
  </body>
</html>
