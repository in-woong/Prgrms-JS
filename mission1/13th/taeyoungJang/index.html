<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list"></div>
    <div id="check-list"></div>
    <div id="validation-list"></div>
    <script>
      const data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ];
      const dataForCheck = [
        {
          text: '커밋은 까먹진 않았나요?',
          isCompleted: false,
        },
        {
          text: '혹시 PR을 잊은건 아니겠죠?',
          isCompleted: true,
        },
      ];
      const dataForValidation = [
        {
          text: '필수 구현사항을 모두 완료했나요?',
          isCompleted: true,
        },
        {
          text: '추가 구현사항을 모두 완료했나요?',
          isCompleted: false,
        },
      ];
      // 이곳에서 코딩을 시작하세요!

      function TodoList($target, state) {
        this.state = [];

        this.validationElement = function (element) {
          if (!element || !(element instanceof HTMLElement)) {
            throw new Error(
              '에러! target 인자값이 존재하지 얺거나 DOM에 존재하지 않는 요소입니다.'
            );
          }
        };
        this.validationConstructor = function () {
          if (!(this instanceof TodoList)) {
            throw new Error(
              '에러! TodoList는 생성자 함수입니다. new 키워드와 함께 호출해주세요.'
            );
          }
        };
        this.validationParameter = function (params) {
          if (params == null || params == undefined) {
            throw new Error(
              '에러! 인자값은 null 또는 undefined일 수 없습니다.'
            );
          }
          if (!Array.isArray(params)) {
            throw new Error('에러! 인자값은 배열 형태의 객체여야 합니다.');
          }
          // 데이터 형태 검증
          const isCorrectShape = params.find(
            (item) =>
              typeof item['text'] !== 'string' ||
              typeof item['isCompleted'] !== 'boolean'
          );
          if (isCorrectShape) {
            throw new Error(
              '에러! 인자값의 데이터 형태가 올바르지 않습니다. [{ text: (string), isCompleted: (boolean) },]와 같은 형태로 만들어 주세요.'
            );
          }
        };
        this.validationElement($target);
        this.validationConstructor();
        this.validationParameter(state);

        this.state = state;
        this.$target = $target;

        this.render = function () {
          const content = this.state.reduce((acc, cur, idx) => {
            return (
              acc +
              (cur.isCompleted
                ? `<li>${idx + 1}: <s>${cur.text}</s></li>`
                : `<li>${idx + 1}: ${cur.text}</li>`)
            );
          }, '');
          this.$target.innerHTML = `<h1>${this.$target.id}</h1><ul>${content}</ul>`;
        };

        this.setState = function (newState) {
          this.validationParameter(newState);

          this.state = newState;

          this.render();
        };

        this.render();
      }

      const $todoList = document.querySelector('#todo-list');
      new TodoList($todoList, data);

      const $checkList = document.querySelector('#check-list');
      const checkList = new TodoList($checkList, dataForCheck);

      const $validationList = document.querySelector('#validation-list');
      new TodoList($validationList, dataForValidation);

      checkList.setState([
        {
          text: '데이터 검증 로직은 작성하였나요?',
          isCompleted: true,
        },
        {
          text: 'setState 메서드 구현은 완료했나요?',
          isCompleted: true,
        },
      ]);
    </script>
  </body>
</html>
