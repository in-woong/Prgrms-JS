<html>

<head>
  <title>Mission 1</title>
  <meta charset="utf-8" />
</head>

<body>
  <div id="todo-list__1"></div>
  <div id="todo-list__2"></div>
  <div id="todo-list__3"></div>
  
  <script>
     const data1 = [
      {
        text: 'JS 공부하기',
        isCompleted: true
      },
      {
        text: 'JS 복습하기',
        isCompleted: true
      }
    ];
    const nextData1 = [
      {
        text: '프로그래머스 FE 스터디 - 미션1 완료하기',
        isCompleted: false
      },
      {
        text: '프로그래머스 FE 스터디 - 미션1 블로깅하기',
        isCompleted: false
      }
    ]
    const data2 = [
      {
        text: '줄넘기',
        isCompleted: true
      },
      {
        text: '라이딩',
        isCompleted: false,
      },
      {
        text: '책 읽기',
        isCompleted: false,
      }
    ]
    const data3 = [
      {
        text: '점심 먹기',
        isCompleted: true,
      },
      {
        text: '저녁 먹기',
        isCompleted: true,
      }
    ]

    function TodoList(data, parentEl) {   
      if(!new.target) throw new Error('new 키워드로 인스턴스를 생성해주세요.');

      this.data = data;
      this.$todoListEl = parentEl;
      
      this.validDataFor = function(data) {
        if(!Array.isArray(data) || data.length === 0) {
          throw new Error('데이터는 길이가 1 이상인 배열 형태이어야 합니다.')
        } 

        if(!data.every(obj => 'text' in obj)) {
          throw new Error('데이터 내에 Todo Text가 없습니다.');
        }

        if(!data.every(obj => typeof obj.text === 'string')) {
          throw new Error('text 데이터는 string 타입이어야 합니다.')
        }
      }

      this.setState = function(nextData) {
        try {
          this.validDataFor(nextData) 
          this.data = nextData;

          this.render();
        } catch(err) {
          console.error(err)  
        }
      }

      this.render = function() {       
        const textsEl = this.data.map(obj => { 
          return obj.isCompleted ? `<li><s>${obj.text}</s></li>` : `<li>${obj.text}</li>`; 
        } ).join('');

        this.$todoListEl.innerHTML = `<ul>${textsEl}</ul>`;
      }
    }

    const $todoListContainer1 = document.querySelector('#todo-list__1'); 
    const todoList1 = new TodoList(data1, $todoListContainer1);

    todoList1.render();
    setTimeout(() => { todoList1.setState(nextData1) }, 1000);

    const $todoListContainer2 = document.querySelector('#todo-list__2');
    const todoList2 =  new TodoList(data2, $todoListContainer2);
    
    todoList2.render();

    const $todoListContainer3 = document.querySelector('#todo-list__3');
    const todoList3 =  new TodoList(data3, $todoListContainer3);
    
    todoList3.render();
  </script>
</body>
</html>
