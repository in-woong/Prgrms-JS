<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <div id="todo-list-01"></div>
    <div id="todo-list-02"></div>
    <div id="todo-list-03"></div>
    <script>
      var data01 = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ]
      var data02 = [
        {
          text: '주말 장보기',
          isCompleted: false,
        },
        {
          text: '락스로 화장실 대청소',
          isCompleted: true,
        },
      ]
      var data03 = [
        {
          text: '블로그 작성하기',
          isCompleted: false,
        },
        {
          text: '업무일지 정리하기',
          isCompleted: true,
        },
      ]
      var data04 = [
        {
          text: '새로운 데이터 추가하기',
          isCompleted: false,
        },
        {
          text: '추가한 데이터로 다시 랜더하기',
          isCompleted: true,
        },
      ]

      class TodoList {
        constructor(targetEl, data) {
          // data가 안전한지 판단
          this.throwError(data)
          this.el = document.getElementById(targetEl)
          this.data = data
          this.render()
        }

        // 값의 타입 체크
        checkValueType(targetObject, checkDataInfo) {
          const isCorrectType = checkDataInfo.every((data) => {
            if (targetObject[data.key] !== undefined) {
              return typeof targetObject[data.key] === data.type
            }
            return false
          })
          return isCorrectType
        }

        checkDataError(data) {
          // data가 배열이 아닌 경우 에러
          if (!Array.isArray(data)) {
            return false
          }

          // 배열이지만, 요소가 객체(배열, null이 아닌)인지 아닌지 체크
          // 값 타입 체크
          const isDataSafe = data.every(
            (item) =>
              item !== null &&
              typeof item === 'object' &&
              !Array.isArray(item) &&
              this.checkValueType(item, [
                { key: 'text', type: 'string' },
                { key: 'isCompleted', type: 'boolean' },
              ])
          )
          return isDataSafe
        }

        throwError(data) {
          if (!this.checkDataError(data)) {
            throw new Error('데이터 형식이 잘못되었습니다.')
          }
        }

        render() {
          const todoListData = this.data.reduce((todoList, todo) => {
            const todoElement = todo.isCompleted
              ? `<li><s>${todo.text}</s></li>`
              : `<li>${todo.text}</li>`
            return todoList + todoElement
          }, '<ul>')

          this.el.innerHTML = todoListData + '</ul>'
        }

        setState(nextData) {
          this.throwError(nextData)
          this.data = nextData
          this.render()
        }
      }

      const todoList01 = new TodoList('todo-list-01', data01)
      const todoList02 = new TodoList('todo-list-02', data02)
      const todoList03 = new TodoList('todo-list-03', data03)
    </script>
  </body>
</html>
