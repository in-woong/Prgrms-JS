<html>
  <head>
    <title>Mission 1</title>
    <meta charset="utf-8" />
    <style>
      .todo {
        background-color: lightgray;
        border-radius: 25px;
        margin: 10px;
        padding: 5px;
        width: 300px;
        text-align: center;
      }
      .completed-todo {
        text-decoration: line-through;
        text-decoration-color: lightcoral;
      }
    </style>
  </head>

  <body>
    <div id="todo-list"></div>
    <div id="todo-list-week"></div>
    <div id="todo-list-month"></div>
    <script>
      const data = [
        {
          text: 'JS 공부하기',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기',
          isCompleted: false,
        },
      ]

      const newData = [
        {
          text: 'JS 공부하기2',
          isCompleted: true,
        },
        {
          text: 'JS 복습하기2',
          isCompleted: false,
        },
      ]
      const dataWeek = [
        {
          text: 'Mission 1 완료하기',
          isCompleted: true,
        },
        {
          text: '추가적으로 보충해보기 ',
          isCompleted: false,
        },
      ]
      const dataMonth = [
        {
          text: '바닐라 자바스크립트 공부하기',
          isCompleted: true,
        },
        {
          text: 'css 공부하기',
          isCompleted: false,
        },
      ]

      const checkTodoListData = (data) => {
        if (!data) {
          throw new Error('data 가 존재하지 않습니다. ')
        }
        if (!Array.isArray(data)) {
          throw new Error('data 는 array 이어야 합니다. ')
        }
        const hasFaultData = data.some(
          (d) =>
            !d.text ||
            typeof d.text !== 'string' ||
            typeof d.isCompleted !== 'boolean'
        )
        if (hasFaultData) {
          throw new Error(
            'data 구조는 {text: string, isCompleted: boolean } 이어야 합니다.'
          )
        }
      }

      class TodoList {
        constructor({ data, domId }) {
          checkTodoListData(data)
          this.data = data
          this.domId = domId
        }

        render() {
          const todoListDiv = document.querySelector(this.domId)
          const dataHtmlString = this.data
            .map((d) => {
              let className = 'todo'
              if (d.isCompleted) {
                className += ' completed-todo'
              }
              return `<div class="${className}" >${d.text}</div>`
            })
            .join('')
          todoListDiv.innerHTML = dataHtmlString
        }

        setState(nextData) {
          this.data = nextData
          this.render()
        }
      }
      const todoList = new TodoList({ data, domId: '#todo-list' })
      const todoListWeek = new TodoList({
        data: dataWeek,
        domId: '#todo-list-week',
      })
      const todoListMonth = new TodoList({
        data: dataMonth,
        domId: '#todo-list-month',
      })

      todoList.render()
      todoListWeek.render()
      todoListMonth.render()

      todoList.setState(newData)
    </script>
  </body>
</html>
