<html>

<head>
  <title>Mission 1</title>
  <meta charset="utf-8" />
</head>

<body>
  <!-- <div id="todo-list"></div>
  <div id="todo-list-today"></div>
  <div id="todo-list-tomorrow"></div> -->
  <div id="TodoList"></div>

  <script>
    const data = [
      {
        text: 'JS 공부하기',
        isCompleted: true
      },
      {
        text: 'JS 복습하기',
        isCompleted: false
      }
    ]
    // 이곳에서 코딩을 시작하세요!

    const todayTodo = [
      {
        text: '미션1 과제하기',
        isCompleted: true
      }
    ]

    const tomorrowTodo = [
      {
        text: '미션1 마무리하기',
        isCompleted: false
      },
      {
        text: '방 청소 하기',
        isCompleted: false
      },
      {
        text: '화예시장 가기',
        isCompleted: false
      }
    ]

    function checkDataValidation(data) {
      if (data == null || typeof data == 'undefined') {
        throw new Error('Data is Empty');
      }

      if (!Array.isArray(data)) {
        throw new Error('Data is not Array');
      }

      data.forEach(
          todo => { if (!todo.hasOwnProperty('text') || !todo.hasOwnProperty('isCompleted')) throw new Error("Data does not have text or isCompleted properties.")}
        );

    }

    function TodoList(data, $target) {

      checkDataValidation(data);

      if (!new.target) {
        throw new Error('use new keyword')
      }

      this.data = data;

      const $todo = document.createElement('div');
      $target.appendChild($todo);

      this.$todo = $todo;
      this.render = () => {
        // let liTagStr = '';
        // this.data.forEach((todo) => {
        //   liTagStr += todo.isCompleted ? `<li><s>${todo.text}</s></li>` : `<li>${todo.text}</li>`;
        // });

        // map, join 사용
        //const liTagStr = data.map(({text, isCompleted}) => isCompleted ? `<li><s>${text}</s></li>` : `<li>${text}</li>`).join('');

        // reduce 사용
        const liTagStr = this.data.reduce((accumulator, {text, isCompleted}) => accumulator + (isCompleted ? `<li><s>${text}</s></li>` : `<li>${text}</li>`), '')

        this.$todo.innerHTML = `<ul>${liTagStr}</ul>`;
      }

      this.setState = (nextData) => {
        this.data = nextData;
        this.render();
      }

      this.render();

    }

    const $target = document.getElementById('TodoList');

    try {
      const todoList = new TodoList(data, $target);

      const todoListToday = new TodoList(todayTodo, $target);

      const todoListTomorrow = new TodoList(tomorrowTodo, $target);

      const newTodo = [
        {
          text: '목록 다시 정하기',
          isCompleted: false
        }
      ]

      todoListTomorrow.setState(newTodo);
    } catch (e) {
      console.log(e.message);
    }


  </script>
</body>

</html>
